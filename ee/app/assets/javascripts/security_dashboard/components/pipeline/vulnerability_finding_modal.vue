<script>
import { GlModal } from '@gitlab/ui';
import SolutionCard from 'ee/vue_shared/security_reports/components/solution_card_vuex.vue';
import VulnerabilityDetailsGraphql from 'ee/security_dashboard/components/shared/vulnerability_details_graphql/index.vue';

export default {
  components: {
    GlModal,
    SolutionCard,
    VulnerabilityDetailsGraphql,
  },
  props: {
    finding: {
      type: Object,
      required: true,
    },
  },
  computed: {
    remediation() {
      return this.finding.remediations?.[0];
    },
    canDownloadPatchForThisVulnerability() {
      return !this.finding.hasMergeRequest && this.remediation?.diff?.length > 0;
    },
  },
};
</script>

<template>
  <gl-modal
    :visible="true"
    modal-id="pipeline-security-vulnerability-details"
    :title="finding.name"
    @hide="$emit('hide')"
  >
    <vulnerability-details-graphql v-bind="finding" />

    <solution-card
      :solution="finding.solution"
      :remediation="remediation"
      :has-mr="finding.hasMergeRequest"
      :has-download="canDownloadPatchForThisVulnerability"
    />

    <!-- adding the comment-history is captured in: https://gitlab.com/gitlab-org/gitlab/-/issues/337488 -->
    <!-- implementing and adding the footer is captured in: https://gitlab.com/gitlab-org/gitlab/-/issues/337487 -->
  </gl-modal>
</template>
